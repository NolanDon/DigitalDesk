<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="favicon.ico" type="image/ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Desk - Submit Item</title>
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/submit.css">
    <script type="module" src="/app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-firestore.js"></script>
</head>

<body>
    <!-- Navbar -->
    <header>
        <div class="logo">
            <a href="/">
                <img src="images/logo.png" alt="Icon" class="navbar-logo">
            </a>
        </div>
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="reviews.html">Reviews</a></li>
                <li><a href="categories.html">Categories</a></li>
                <li><a href="popular.html">Popular</a></li>
                <li><a href="guides.html">Guides</a></li>
            </ul>
            <a id="add-item-link"></a>
            <a id="sign-in" class="distinct-button" href="#">Login</a>
            <div id="sign-in-status"></div>

            <div class="hamburger" id="hamburger">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </nav>
    </header>

    <section id="submit-item">
        <h2>Submit a New Item</h2>
        <form id="item-form">
            <label for="item-name">Item Name:</label>
            <input type="text" id="item-name" required>

            <label for="item-description">Item Description:</label>
            <textarea id="item-description" required></textarea>

            <label for="item-image">Upload Image:</label>
            <input type="file" id="item-image" accept="image/*">
            <img id="image-preview" src="#" alt="Image Preview" style="display:none; max-width:100%; margin-top:10px;">
            <button type="submit">Submit Item</button>
        </form>
    </section>

    <script type="text/javascript">

        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                const signInButton = document.getElementById('sign-in');
                // const signInStatus = document.getElementById('sign-in-status');
                // const accountDetails = document.getElementById('account-details');
                const addItemLink = document.getElementById('add-item-link');


                if (user) {
                    // If the user is Nolan, add the "Add Item" link
                    if (user.email === "nolan796@live.ca") {
                        console.log("user email matched, adding <a> tag")
                        addItemLink.innerHTML = '<a href="/add-item.html" class="distinct-button">Add Item</a>';
                    } else {
                        addItemLink.innerHTML = '';
                    }

                    // User is signed in
                    signInButton.textContent = 'Sign out';
                    signInButton.onclick = () => {
                        firebase.auth().signOut().then(function () {
                            signInButton.textContent = 'Login'; // Reset the button text
                            signInStatus.textContent = ''; // Clear the status
                            // accountDetails.textContent = ''; // Clear the account details
                        }).catch((error) => {
                            console.error('Sign out error:', error);
                        });
                    };

                    // accountDetails.textContent = JSON.stringify(user, null, 2); // Format user data nicely
                } else {
                    // User is not signed in
                    signInButton.textContent = 'Login';
                    signInButton.onclick = () => {
                        window.location.href = '/login.html'; // Redirect to the login page
                    };

                    // accountDetails.textContent = '';
                    addItemLink.innerHTML = ''; // Ensure the "Add Item" link is removed if logged out
                }
            }, function (error) {
                console.log(error);
            });
        };

        window.addEventListener('load', function () {
            initApp()
        });
    </script>
    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.getElementById('item-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const itemName = document.getElementById('item-name').value;
            const itemDescription = document.getElementById('item-description').value;

            const itemData = {
                name: itemName,
                description: itemDescription,
                submittedBy: auth.currentUser.email,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection("items").add(itemData)
                .then(() => {
                    alert("Item submitted successfully!");
                    document.getElementById('item-form').reset();
                })
                .catch((error) => {
                    console.error("Error submitting item: ", error);
                    alert("Error submitting item.");
                });
        });

        window.addEventListener('load', function () {
            if (!auth.currentUser) {
                document.getElementById('sign-in').textContent = 'Login';
                document.getElementById('sign-in').onclick = function () {
                    window.location.href = '/login.html';
                };
            }
        });
    </script>
      <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
      <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>

      <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
      <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
  
      <!-- Add Firebase products that you want to use -->
      <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-firestore.js"></script>
      <!-- <script src="./Auth.js"></script> -->
      <script src="./_config/firebase.js"></script>
</body>

</html>
